<!DOCTYPE html>
<html>
    <head>
        <title>Driver Location Tracking</title>
        <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
            rel="stylesheet"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            .marker-pulse {
                width: 36px;
                height: 36px;
                background-color: inherit;
                border-radius: 50%;
                position: absolute;
                animation: pulse 1.5s ease-out infinite;
            }

            .marker-core {
                width: 24px;
                height: 24px;
                background-color: inherit;
                border-radius: 50%;
                border: 3px solid white;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            @keyframes pulse {
                0% {
                    transform: scale(0.5);
                    opacity: 1;
                }
                100% {
                    transform: scale(2);
                    opacity: 0;
                }
            }

            /* Location update animation */
            .location-update {
                animation: highlight 0.5s ease-out;
            }

            @keyframes highlight {
                0% {
                    background-color: rgba(59, 130, 246, 0.1);
                }
                100% {
                    background-color: transparent;
                }
            }

            /* Status badge styles */
            .status-badge {
                padding: 0.25rem 0.75rem;
                border-radius: 9999px;
                color: white;
                font-size: 0.875rem;
                font-weight: 500;
                box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            }
        </style>
    </head>
    <body class="bg-gray-100 text-gray-800 leading-relaxed font-roboto">
        <div class="max-w-7xl mx-auto p-5">
            <div
                class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-5 rounded-lg mb-5 shadow"
            >
                <h1 class="text-2xl font-medium mb-2">
                    Driver Location Tracking System
                </h1>
                <p>Real-time tracking and monitoring of all active drivers</p>
            </div>

            <div class="bg-white p-5 rounded-lg mb-5 shadow">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-1">
                        <div class="text-lg font-medium">Dương Ngọc Anh</div>
                        <div class="text-sm text-gray-600">29S1_98637</div>
                        <input
                            type="hidden"
                            id="driverSelect"
                            value="6778b7848652dafe31a9788f"
                        />
                    </div>
                    <div
                        id="onlineStatus"
                        class="px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm font-medium"
                    >
                        Offline
                    </div>
                </div>

                <div class="flex flex-wrap gap-3 mb-4">
                    <button
                        onclick="toggleApp()"
                        id="toggleAppBtn"
                        class="bg-blue-500 text-white px-6 py-3 rounded-lg font-medium uppercase tracking-wide hover:-translate-y-0.5 transition-transform hover:shadow-lg flex-1"
                    >
                        Enable App
                    </button>
                    <button
                        onclick="goOffline()"
                        id="offlineBtn"
                        class="bg-gray-500 text-white px-6 py-3 rounded-lg font-medium uppercase tracking-wide hover:-translate-y-0.5 transition-transform hover:shadow-lg flex-1"
                        style="display: none"
                    >
                        Go Offline
                    </button>
                    <div class="button-group w-full">
                        <button
                            onclick="notifyArrival()"
                            class="bg-green-500 text-white px-6 py-3 rounded-lg font-medium uppercase tracking-wide hover:-translate-y-0.5 transition-transform hover:shadow-lg"
                            id="arrivalBtn"
                            style="display: none"
                        >
                            Arrived at Pickup
                        </button>
                        <button
                            onclick="startTrip()"
                            class="bg-green-500 text-white px-6 py-3 rounded-lg font-medium uppercase tracking-wide hover:-translate-y-0.5 transition-transform hover:shadow-lg"
                            id="startTripBtn"
                            style="display: none"
                        >
                            Start Trip
                        </button>
                        <button
                            onclick="endTrip()"
                            class="bg-red-500 text-white px-6 py-3 rounded-lg font-medium uppercase tracking-wide hover:-translate-y-0.5 transition-transform hover:shadow-lg"
                            id="endTripBtn"
                            style="display: none"
                        >
                            End Trip
                        </button>
                    </div>
                </div>

                <div
                    id="status"
                    class="p-4 rounded-lg bg-blue-50 text-blue-800 border-l-4 border-blue-500"
                >
                    App is disabled. Click Enable App to go online.
                </div>
            </div>

            <div class="bg-white p-5 rounded-lg mb-5 shadow">
                <h3 class="text-lg font-medium text-blue-800 mb-3">
                    Current Location
                </h3>
                <div
                    id="currentLocation"
                    class="font-mono p-3 bg-gray-50 rounded"
                >
                    Not tracking
                </div>
            </div>

            <div
                id="map"
                class="h-[500px] rounded-lg overflow-hidden shadow relative"
            >
                <div
                    id="zoomLevel"
                    class="absolute bottom-4 right-4 bg-white px-3 py-1 rounded shadow z-[1000] text-sm"
                >
                    Zoom: 13
                </div>
            </div>
        </div>

        <div
            id="overlay"
            class="fixed inset-0 bg-black bg-opacity-50 z-[9998] hidden"
        ></div>

        <div
            id="rideRequestDialog"
            class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded-xl shadow-xl z-[9999] hidden min-w-[300px]"
        >
            <h3 class="text-xl font-medium text-green-500 text-center mb-5">
                New Ride Request
            </h3>
            <div id="rideRequestContent" class="mb-5 space-y-2"></div>
            <div class="flex justify-center gap-3">
                <button
                    onclick="handleRideAccept()"
                    class="bg-green-500 text-white px-6 py-3 rounded-lg min-w-[100px] font-medium hover:bg-green-600 transition-colors"
                >
                    Accept
                </button>
                <button
                    onclick="handleRideReject()"
                    class="bg-red-500 text-white px-6 py-3 rounded-lg min-w-[100px] font-medium hover:bg-red-600 transition-colors"
                >
                    Reject
                </button>
            </div>
        </div>

        <!-- Load JavaScript files in correct order -->
        <script type="module" src="js/config.js"></script>
        <script type="module" src="js/driver-app-state.js"></script>
        <script type="module" src="js/driver-map.js"></script>
        <script type="module" src="js/driver-map-utils.js"></script>
        <script type="module" src="js/driver-ui.js"></script>
        <script type="module" src="js/driver-socket.js"></script>
        <script type="module" src="js/driver-tracking.js"></script>
        <script type="module" src="js/driver-ride-request.js"></script>
        <script type="module" src="js/driver-trip.js"></script>
        <script type="module" src="js/driver-init.js"></script>
    </body>
</html>
